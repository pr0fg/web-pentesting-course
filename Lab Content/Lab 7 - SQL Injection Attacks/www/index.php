<?php

include 'header.php';

if($_SESSION['id'] == 1) {
    echo "Challenge 1 complete! Flag: 1fb617e9cdf13ff62a85f034db18c16c";
}
else if($_SESSION['id'] == 3) {
    echo "Challenge 2 complete! Flag: 2628662e4324033eb69530f9badc0f4a";
}

?>

<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8" />
  <title>Home</title>
</head>
<body>
    <h1 id="name">Welcome back <i><?= $_SESSION['username'] ?></i></h1>
    <input type="button" onclick="window.location.href = '/logout.php';" value="Logout"/>
    <input type="button" onclick="window.location.href = '/changePassword.php';" value="Change Password"/>
    <br/><br/>
    <h2>New Posts:</h2>
    <div id="posts" style="width: 80%">
        <table>
            <tr><th>Title</th><th>View</th></tr>

            <?php

                include 'db.php';

                $result = $mysqli->query("SELECT * FROM posts WHERE visible=1");
                if(!$result) {
                    die("MySQL query failed: (" . $mysqli->errno . ") " . $mysqli->error);
                }

                while($post = $result->fetch_assoc()) {
                    echo '<tr><td>' . $post['title'] . '</td><td><a href="/viewPost.php?i=' . $post['id'] . '">View Post</a></td></tr>';
                }

            ?>
        </table>
    </div>
    <br/>
    <h2>Search for Post:</h2>
    <form name="input" action="/searchPosts.php" method="post">
        <input type="text" value="" id="q" name="q" />
        <input type="submit" value="Search" name="search" />
    </form>
</body>
</html>