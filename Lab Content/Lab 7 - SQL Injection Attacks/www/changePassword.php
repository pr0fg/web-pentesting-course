<?php

include 'header.php';

$errorMsg = "";

if(isset($_POST["change"]) && strpos($_POST['id'], '1') === 0) {

  if(!$_POST['password'] || !$_POST["id"]) {
    $errorMsg = 'Missing password!';
  }

  else {
    
    include 'db.php';

    $id = $_POST['id'];
    $password = md5(rtrim($_POST['password']));

    $result = $mysqli->query("UPDATE users SET password='$password' WHERE id=$id");

    if(!$result) {
        die("MySQL query failed: (" . $mysqli->errno . ") " . $mysqli->error);
    }

    header("Location: /logout.php");
  }
}

?>

<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8" />
  <title>Change Password</title>
</head>
<body>
  <form name="input" action="" method="post">
    New Password: <input type="text" value="" id="password" name="password" /><br/>
    <input type="hidden" value="<?= $_SESSION['id'] ?>" id="id" name="id" /><br/>
    <input type="button" onclick="window.location.href = '/';" value="Back"/>
    <input type="submit" value="Change Password" name="change" />
  </form>
  <div class="error"><font color="red"><?= $errorMsg ?></font></div>
</body>
</html>