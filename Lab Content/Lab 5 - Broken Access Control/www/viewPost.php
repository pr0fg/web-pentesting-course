<?php
session_start();
if (!isset($_SESSION['username'])) {
	header("Location: /login.php");
	die();
}
?>

<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8" />
  <title>Feed</title>
</head>
<body>
	<h1><div id="title">Loading...</div></h1>
	<div id="content"></div><br/>
	<input type="button" onclick="window.location.href = '/';" value="Back"/>
	<script>

		function getUrlVars() {
		    var vars = {};
		    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
		    	if(value < 50){ vars[key] = value; }
		    });
		    return vars;
		}

		function retrievePost() {
			xmlhttp = new XMLHttpRequest();
			xmlhttp.onreadystatechange = function() {
			  if (this.readyState == 4 && this.status == 200) {
			  	try {
			    	response=JSON.parse(this.responseText);
			    	document.getElementById("title").innerHTML = response.title;
					document.getElementById("content").innerHTML = response.content;
			    }
			    catch (e) {
			    	console.log('Error fetching post.');
			    }
			  }
			};
			var postId = getUrlVars()["i"];
			if(postId) { 
				xmlhttp.open("GET", "/api/posts/" + postId + '.php', true);
				xmlhttp.send(); 
			}
		}

		retrievePost();
	</script>
</body>
</html>