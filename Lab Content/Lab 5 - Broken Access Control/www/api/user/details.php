<?php

session_start();
if (!isset($_SESSION['username'])) {
	header("Location: /login.php");
	die();
}

header("Content-Type: application/json; charset=UTF-8");

$firstNames = ['Michael', 'David', 'Christopher', 'Mary', 'Lisa', 'Ashley', 'Andrew', 'Kevin', 'Nancy', 'Michelle'];
$lastNames = ['Smith', 'Johnson', 'Brown', 'Jones', 'Clark', 'Miller', 'White', 'Williams', 'Thomas', 'Harris'];

if(isset($_GET['u'])) {

	$array = [];

	if($_GET['u'] == '8171') {
		$array = [
		    "username" => "Brent.Macrae",
		    "firstName" => "Brent",
		    "lastName" => "White",
		];
	}
	else if(array_key_exists('user'.$_GET['u'], $_SESSION)) {
		$fnRand = $_SESSION['user'.$_GET['u']][0];
		$lnRand = $_SESSION['user'.$_GET['u']][1];
		if($firstNames[$fnRand] == 'Michael' && $lastNames[$lnRand] == 'Miller') {
			$array = [
		    	"username" => 'Challenge 3 completed! Flag: 3dcc44f904f3af84be87150dbb293a02',
		    	"firstName" => "Michael",
		    	"lastName" => "Miller",
			];
		}
		else {
			$array = [
			    "username" => $firstNames[$fnRand].'.'.$lastNames[$lnRand],
			    "firstName" => $firstNames[$fnRand],
			    "lastName" => $lastNames[$lnRand],
			];
		}	
	}
	else if(8000 <= $_GET['u'] && $_GET['u'] < 9000) {

		$fnRand = array_rand($firstNames);
		$lnRand = array_rand($lastNames);

		if($fnRand == 'Michael' && $lnRand == 'Miller') {
			$array = [
		    	"username" => 'Challenge 3 completed! Flag: 3dcc44f904f3af84be87150dbb293a02',
		    	"firstName" => "Michael",
		    	"lastName" => "Miller",
			];
		}
		else {
			$array = [
		    	"username" => $firstNames[$fnRand].'.'.$lastNames[$lnRand],
		    	"firstName" => $firstNames[$fnRand],
		    	"lastName" => $lastNames[$lnRand],
			];
		}
		$_SESSION['user'.$_GET['u']][0] = $fnRand;
		$_SESSION['user'.$_GET['u']][1] = $lnRand;
	}
	
	$result = json_encode($array);
	echo $result;
}

?>