FROM romeoz/docker-apache-php

RUN sed -i 's/Options FollowSymLinks/Options Indexes FollowSymLinks/g' /etc/apache2/sites-enabled/app.conf

RUN mkdir /var/www/app/cgi-bin && chmod 000 /var/www/app/cgi-bin
RUN echo 'Find the Apache server version to complete Challenge 1!' > /var/www/app/index.php

RUN a2enmod userdir
RUN adduser --disabled-password --gecos "" --home /home/bob bob
RUN adduser --disabled-password --gecos "" --home /home/jane jane
RUN mkdir /home/bob/public_html
RUN mkdir /home/jane/public_html
RUN echo 'Challenge 2 completed. Flag: 5bc2b8de670a9a0d8f83df6f2c99b893' > /home/bob/public_html/index.html
RUN echo 'Challenge 3 completed. Flag: cee35e886a2380c0a192edd766a8d1d2' > /home/jane/public_html/secret.txt

RUN mkdir /var/www/app/backup/
RUN cd /var/www/app/backup/ && echo '<?php echo "Challenge 4 completed. Flag: 6e07f9a488930f9c46a9f06cbf79f76f";' > index.php.bak && echo 'Challenge 4 completed. Flag: 6e07f9a488930f9c46a9f06cbf79f76f' > db.sql

RUN echo '<?php echo "Challenge 5 completed. Flag: 347a00bfb94ae3fec3a19fc7844d2cf3"; phpinfo(); ?>' > /var/www/app/test.php

RUN echo '<?php $output = (isset($_GET["debug"]) ? "Challenge 7 completed. Flag: 594fef5d7d012d6c3b3bd7224a796f18" : "Challenge 6 completed. Flag: 80301c6c2973e6710ba419ef613898da. Can you get to the next level from this page?"); echo "$output"; ?>' > /var/www/app/index2.php

RUN mkdir /var/www/app/plugins && echo '' > /var/www/app/plugins/index.php
RUN echo 'Challenge 8 completed. Flag: 427c9eb5b4f9663326869910a7b796dd' > /var/www/app/plugins/test.php

RUN mkdir /var/www/app/.git && echo '' > /var/www/app/.git/index.php
RUN echo 'Challenge 9 completed. Flag: 4c45a8295d6a55205444040b30f523f4' > /var/www/app/.git/HEAD

RUN echo "User-agent: *\nDisallow: /test777.php" > /var/www/app/robots.txt
RUN echo "Challenge 10 completed. Flag: 08d7ea45d7c3215323f3872946494c4e" > /var/www/app/test777.php